# 高精度模式优化任务清单

## 背景
高精度模式下的生成流程目前遇到Vercel的60秒API请求时间限制，导致大型内容无法成功生成。需要优化生成流程，将大请求分解为多个小请求，并新增页面导航与动画步骤。

## 分析与设计
- [ ] 分析当前高精度模式实现逻辑和超时原因
- [ ] 设计请求分片策略，确定如何将大型内容请求分解为多个小请求
- [ ] 规划新的步骤3（页面导航与过渡动画）
- [ ] 设计步骤之间的上下文传递机制，确保分片请求间信息一致性
- [ ] 规划用户界面提示，使用户了解分片生成的进度

## 实现优化
- [ ] 修改`generate-step/route.ts`，实现请求分片逻辑
  - [ ] 添加文本分块函数，根据内容长度将文本拆分为多个部分
  - [ ] 实现分块请求的状态管理，记录当前处理的文本块和进度
  - [ ] 优化错误处理，添加针对分片请求的重试机制
- [ ] 实现新的步骤3：页面导航与过渡动画
  - [ ] 添加`page-navigation`步骤处理逻辑
  - [ ] 创建页面导航相关的提示词模板
  - [ ] 实现页面过渡动画相关的CSS和JavaScript代码生成
- [ ] 调整原有步骤顺序
  - [ ] 将原来的步骤3（内容页面生成）延后至步骤4
  - [ ] 确保步骤间衔接流畅，保持上下文一致性
- [ ] 更新前端代码，适配新的生成流程
  - [ ] 修改生成状态管理逻辑，支持分片请求和额外步骤
  - [ ] 更新进度显示UI，展示分片请求的进度情况
  - [ ] 优化错误处理，针对分片请求可能出现的问题提供友好提示

## 测试与验证
- [ ] 使用小型内容（<5000字）测试优化后的流程
- [ ] 使用中型内容（5000-20000字）验证分片请求功能
- [ ] 使用大型内容（>20000字）进行压力测试
- [ ] 测试错误场景（网络中断、服务器错误等）的恢复机制
- [ ] 验证生成的HTML页面之间的导航和过渡动画效果 